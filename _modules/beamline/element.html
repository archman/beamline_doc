<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>beamline.element &mdash; beamline 1.3.5 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="beamline 1.3.5 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">beamline 1.3.5 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for beamline.element</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot; This module defines all kinds of magnet components/elements.</span>

<span class="sd">.. Author: Tong Zhang</span>
<span class="sd">.. Created     : 2016-03-22</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">epics</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">mathutils</span>


<div class="viewcode-block" id="MagBlock"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock">[docs]</a><span class="k">class</span> <span class="nc">MagBlock</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Super class of all elements, part of configuration parameters are</span>
<span class="sd">    defined here:</span>

<span class="sd">    * objcnt: object counter, if create/add element one by one, objcnt will return the total element number by sumObjNum() method;</span>

<span class="sd">    * comminfo: the shared common information for all elements, could be defined by calling setCommInfo() static method;</span>

<span class="sd">    * __styleconfig_dict: style configurations for element drawing, could be defined by setStyleConfig() static method;</span>

<span class="sd">    New element should inherit MagBlock, and define following methods:</span>
<span class="sd">    __init__(), setStyle(), setDraw()</span>

<span class="sd">    class constructor</span>
<span class="sd">    :param name: literal name of the element, None by default</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">objcnt</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># object counter</span>
    <span class="n">comminfo</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># common information</span>
    <span class="n">__styleconfig_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;quad&#39;</span><span class="p">:</span>
            <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;fc&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;ec&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.50</span><span class="p">,},</span>
        <span class="s1">&#39;bend&#39;</span><span class="p">:</span>
            <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;fc&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;ec&#39;</span><span class="p">:</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.50</span><span class="p">,},</span>
        <span class="s1">&#39;drift&#39;</span><span class="p">:</span>
            <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">},</span>
        <span class="s1">&#39;moni&#39;</span><span class="p">:</span>
            <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#FF9500&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">},</span>
    <span class="p">}</span>  <span class="c1"># global configuration for element style, dict</span>
    <span class="n">__styleconfig_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">__styleconfig_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; class constructor</span>
<span class="sd">        :param name: literal name of the element, None by default</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">MagBlock</span><span class="o">.</span><span class="n">objcnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>     <span class="c1"># element name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># element type name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comminfo</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">comminfo</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>  <span class="c1"># common information</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simuinfo</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># simulation information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlinfo</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># control information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">miscinfo</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># other information</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">simukeys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># keywords of simulation information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlkeys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># keywords of control information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misckeys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># keywords of other information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transfun</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># unit translation function</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setConfDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;simu&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setSimuConf</span><span class="p">,</span>
                            <span class="s1">&#39;ctrl&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setCtrlConf</span><span class="p">,</span>
                            <span class="s1">&#39;misc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setMiscConf</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prtConfigDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;simu&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printSimuConf</span><span class="p">,</span>
                              <span class="s1">&#39;ctrl&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printCtrlConf</span><span class="p">,</span>
                              <span class="s1">&#39;misc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printMiscConf</span><span class="p">,</span>
                              <span class="s1">&#39;comm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printCommConf</span><span class="p">,</span>
                              <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printAllConf</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dumpConfigDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;simu&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpSimuConf</span><span class="p">,</span>
                               <span class="s1">&#39;ctrl&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpCtrlConf</span><span class="p">,</span>
                               <span class="s1">&#39;misc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpMiscConf</span><span class="p">,</span>
                               <span class="s1">&#39;comm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpCommConf</span><span class="p">,</span>
                               <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpAllConf</span><span class="p">,</span>
                               <span class="s1">&#39;online&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpOnlineConf</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">styledict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># style dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># patches list, empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for visualization, initial incremental angle</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_spos</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># element position along beamline/lattice, in [m]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># default element transport matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM_flag</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># if calcTransM() is called</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; element name property</span>
<span class="sd">        :return: element name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element name property</span>
<span class="sd">        :param name: new element name</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="MagBlock.rot"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.rot">[docs]</a>    <span class="k">def</span> <span class="nf">rot</span><span class="p">(</span><span class="n">inputArray</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; rotate input array with angle of theta</span>

<span class="sd">        :param inputArray: input array or list,</span>
<span class="sd">                           e.g. np.array([[0,0],[0,1],[0,2]]) or [[0,0],[0,1],[0,2]]</span>
<span class="sd">        :param theta: rotation angle in degree</span>
<span class="sd">        :param pc: central point coords (x,y) regarding to rotation</span>
<span class="sd">        :return: rotated numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputArray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">inputArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">inputArray</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># degree to rad</span>
        <span class="n">mr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                <span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mr</span><span class="p">,</span> <span class="p">(</span><span class="n">inputArray</span><span class="o">-</span><span class="n">pc</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">+</span> <span class="n">pc</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="MagBlock.copy_patches"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.copy_patches">[docs]</a>    <span class="k">def</span> <span class="nf">copy_patches</span><span class="p">(</span><span class="n">ptches0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return a list of copied input matplotlib patches </span>
<span class="sd">            </span>
<span class="sd">        :param ptches0: list of matploblib.patches objects</span>
<span class="sd">        :return: copyed patches object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ptches0</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">ptches0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ptches0</span><span class="p">)</span>
        <span class="n">copyed_ptches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">ptches0</span><span class="p">:</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span>
                                     <span class="n">lw</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">get_lw</span><span class="p">(),</span>
                                     <span class="n">fc</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">get_fc</span><span class="p">(),</span>
                                     <span class="n">ec</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">get_ec</span><span class="p">(),</span>
                                     <span class="n">alpha</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">get_alpha</span><span class="p">())</span>
            <span class="n">copyed_ptches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copyed_ptches</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="MagBlock.sumObjNum"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.sumObjNum">[docs]</a>    <span class="k">def</span> <span class="nf">sumObjNum</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: number of defined element object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">objcnt</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="MagBlock.setCommInfo"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.setCommInfo">[docs]</a>    <span class="k">def</span> <span class="nf">setCommInfo</span><span class="p">(</span><span class="n">infostr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set common information, update MagBlock.comminfo</span>

<span class="sd">        :param infostr: should be met one of the following options:</span>

<span class="sd">                            * infostr is a dict, {k1:v1, k2:v2}</span>
<span class="sd">                            * infostr is a string, with format like: &quot;k1=v1, k2=v2&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infostr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">infostr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">MagBlock</span><span class="o">.</span><span class="n">comminfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infostr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">str2dict</span><span class="p">(</span><span class="n">infostr</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">MagBlock</span><span class="o">.</span><span class="n">comminfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Information string ERROR.&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="MagBlock.str2dict"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.str2dict">[docs]</a>    <span class="k">def</span> <span class="nf">str2dict</span><span class="p">(</span><span class="n">istr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; translate string into dict</span>

<span class="sd">        :param istr: string with format like: &quot;k1=v1, k2=v2&quot; ...</span>
<span class="sd">        :return: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;lattice&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">istr</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">tmpstr</span> <span class="o">=</span> <span class="n">istr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmpstr</span> <span class="o">=</span> <span class="n">istr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmpstr</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmpstr</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="MagBlock.setStyleConfig"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.setStyleConfig">[docs]</a>    <span class="k">def</span> <span class="nf">setStyleConfig</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showhelp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set/update global style configurations for magblock elements</span>
<span class="sd">        update Magblock._styleconfig_dict and _styleconfig_json</span>

<span class="sd">        :param config: configuration dict or json</span>
<span class="sd">        :param showhelp: if True, print showhelp information, default is False</span>
<span class="sd">        :return: new style config dict</span>

<span class="sd">        :Example:</span>

<span class="sd">        &gt;&gt;&gt; MagBlock.setStyleConfig(</span>
<span class="sd">            config={&#39;quad&#39;:{&#39;fc&#39;:&#39;blue&#39;, &#39;ec&#39;: &#39;blue&#39;},</span>
<span class="sd">                    &#39;bend&#39;:{&#39;fc&#39;:&#39;red&#39;, &#39;ec&#39;: &#39;red&#39;}})</span>
<span class="sd">        &gt;&gt;&gt; MagBlock.setStyleConfig(showhelp=True)</span>
<span class="sd">        The input configuration string should be with the format like:</span>
<span class="sd">        {&quot;quad&quot;: {&quot;h&quot;: 0.6, &quot;fc&quot;: &quot;red&quot;, &quot;ec&quot;: &quot;red&quot;, &quot;alpha&quot;: 0.5},</span>
<span class="sd">         &quot;drift&quot;: {&quot;color&quot;: &quot;black&quot;, &quot;h&quot;: 0.1, &quot;alpha&quot;: 0.75, &quot;lw&quot;: 1},</span>
<span class="sd">         &quot;bend&quot;: {&quot;h&quot;: 0.5, &quot;fc&quot;: &quot;blue&quot;, &quot;ec&quot;: &quot;blue&quot;, &quot;alpha&quot;: 0.5},</span>
<span class="sd">         &quot;moni&quot;: {&quot;color&quot;: &quot;#FF9500&quot;, &quot;lw&quot;: 1, &quot;alpha&quot;: 0.75}}</span>
<span class="sd">        with all or part of new properties, e.g. {&quot;quad&quot;: {&quot;fc&quot;: &quot;blue&quot;}}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">showhelp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The input configuration string should be with the format like:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_json</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;with all or part of new properties, e.g.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;quad&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fc&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">}}))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">k1</span><span class="p">]</span>
                <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">k1</span><span class="p">]</span>
                <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Information string ERROR.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span></div>

<div class="viewcode-block" id="MagBlock.setConf"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.setConf">[docs]</a>    <span class="k">def</span> <span class="nf">setConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set information for different type dict,</span>

<span class="sd">        :param conf: configuration information, str or dict</span>
<span class="sd">        :param type: simu, ctrl, misc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">conf</span> <span class="o">=</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">str2dict</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setConfDict</span><span class="p">[</span><span class="nb">type</span><span class="p">](</span><span class="n">conf</span><span class="p">)</span></div>

<div class="viewcode-block" id="MagBlock.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element style configuration</span>

<span class="sd">        :param style: dict of keys: &#39;color&#39;, &#39;h&#39;, &#39;alpha&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MagBlock.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>

<span class="sd">        :param angle: rotation angle</span>
<span class="sd">        :param p0: start drawing point coords, (x, y)</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">p0</span></div>

<div class="viewcode-block" id="MagBlock.printConfig"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.printConfig">[docs]</a>    <span class="k">def</span> <span class="nf">printConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; print information about element</span>

<span class="sd">        :param type: comm, simu, ctrl, misc, all</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{s1}{s2:^22s}{s1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">s2</span><span class="o">=</span><span class="s2">&quot;Configuration START&quot;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Element name: </span><span class="si">{en}</span><span class="s2"> (</span><span class="si">{cn}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">en</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position: s = </span><span class="si">{pos:.3f}</span><span class="s2"> [m]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spos</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prtConfigDict</span><span class="p">[</span><span class="nb">type</span><span class="p">]()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{s1}{s2:^22s}{s1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">s2</span><span class="o">=</span><span class="s2">&quot;Configuration END&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MagBlock.dumpConfig"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.dumpConfig">[docs]</a>    <span class="k">def</span> <span class="nf">dumpConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;elegant&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; dump element configuration to given format,</span>
<span class="sd">            inpurt parameters:</span>

<span class="sd">        :param type: comm, simu, ctrl, misc, all, online (default)</span>
<span class="sd">        :param format: elegant/mad, elegant by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumpConfigDict</span><span class="p">[</span><span class="nb">type</span><span class="p">](</span><span class="nb">format</span><span class="p">)</span></div>

<div class="viewcode-block" id="MagBlock.getConfig"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.getConfig">[docs]</a>    <span class="k">def</span> <span class="nf">getConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;elegant&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; only dump configuration part, dict</span>

<span class="sd">        :param type: comm, simu, ctrl, misc, all, online (default)</span>
<span class="sd">        :param format: elegant/mad, elegant by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumpConfigDict</span><span class="p">[</span><span class="nb">type</span><span class="p">](</span><span class="nb">format</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_setSimuConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simuinfo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simukeys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simukeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simukeys</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_setCtrlConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlinfo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlkeys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrlkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrlkeys</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_setMiscConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">miscinfo</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misckeys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misckeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misckeys</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_printSimuConf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simuinfo</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation configs:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simuinfo</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">{k:6s}</span><span class="s2"> = </span><span class="si">{v:6s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_printCommConf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comminfo</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Common configs:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comminfo</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">{k:6s}</span><span class="s2"> = </span><span class="si">{v:6s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_printCtrlConf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get PV value and print out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlinfo</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Control configs:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrlinfo</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">pv</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;pv&#39;</span><span class="p">]</span>
                <span class="n">rval</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitTrans</span><span class="p">(</span><span class="n">rval</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">{k:6s}</span><span class="s2"> = </span><span class="si">{pv:6s}</span><span class="s2">, raw: </span><span class="si">{rval:&gt;6s}</span><span class="s2">, real: </span><span class="si">{val:&gt;6s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span>
                                                                                    <span class="n">pv</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">pv</span><span class="p">),</span>
                                                                                    <span class="n">rval</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">rval</span><span class="p">),</span>
                                                                                    <span class="n">val</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_printMiscConf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">miscinfo</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Miscellaneous configs:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">miscinfo</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">{k:6s}</span><span class="s2"> = </span><span class="si">{v:6s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_printAllConf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># allinfo = {}</span>
        <span class="c1"># map(allinfo.update, [self.comminfo, self.ctrlinfo, self.miscinfo, self.simuinfo])</span>
        <span class="c1"># for k,v in sorted(allinfo.items(), reverse=True):</span>
        <span class="c1">#    print(&quot;{k:6s} = {v:6s}&quot;.format(k=k,v=v))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printCommConf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printSimuConf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printCtrlConf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printMiscConf</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_dumpSimuConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">simuinfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simukeys</span><span class="p">}}}</span>

    <span class="k">def</span> <span class="nf">_dumpMiscConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">miscinfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">misckeys</span><span class="p">}}}</span>

    <span class="k">def</span> <span class="nf">_dumpCtrlConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlinfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlkeys</span><span class="p">}}}</span>

    <span class="k">def</span> <span class="nf">_dumpCommConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">comminfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comminfo</span><span class="o">.</span><span class="n">keys</span><span class="p">()}}}</span>

    <span class="k">def</span> <span class="nf">_dumpAllConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="n">allinfo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">map</span><span class="p">(</span><span class="n">allinfo</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comminfo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">miscinfo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simuinfo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlinfo</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">allinfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">allinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">()}}}</span>

    <span class="k">def</span> <span class="nf">_dumpOnlineConf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; dump element configuration json string for online modeling,</span>
<span class="sd">        in which control configuration should be overwritten simulation conf,</span>
<span class="sd">        e.g. in simuinfo: {&#39;k1&#39;:10,&#39;l&#39;:1}, ctrlinfo: {&#39;k1&#39;:pv_name,...}</span>
<span class="sd">        the k1 value should be replaced by pv_name, and from which</span>
<span class="sd">        the value read into, take note the simuinfo and ctrlinfo</span>
<span class="sd">        would not be changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oinfod</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">simuinfo</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">oinfod</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrlkeys</span><span class="p">)):</span>
            <span class="n">oinfod</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlinfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">:</span> <span class="n">oinfod</span><span class="p">}}</span>

<div class="viewcode-block" id="MagBlock.unitTrans"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.unitTrans">[docs]</a>    <span class="k">def</span> <span class="nf">unitTrans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inval</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">transfun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; unit translation between EPICS PV and physical values,</span>

<span class="sd">        :param inval: input val,</span>
<span class="sd">        :param direction: &#39;+&#39;: PV-&gt;physical, &#39;-&#39;: physical-&gt;PV, &#39;+&#39; by default,</span>
<span class="sd">        :param transfun: userdefined translation function, None by default, could be defined through creating obj.transfun</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outval</span> <span class="o">=</span> <span class="n">inval</span>
        <span class="k">return</span> <span class="n">outval</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return simulation configuration dict as json string format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dumpConfig</span><span class="p">())</span>

<div class="viewcode-block" id="MagBlock.showDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.showDraw">[docs]</a>    <span class="k">def</span> <span class="nf">showDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show the element drawing</span>

<span class="sd">        :param fignum: define figure number to show element drawing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="nb">print</span> <span class="s2">&quot;Please setDraw() before showDraw(), then try again.&quot;</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
            <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="p">]</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">get_extents</span><span class="p">()</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
            <span class="c1"># x1,y1=tuple(self.nextp0)</span>
            <span class="c1"># x2,y2=tuple(self.nextp1)</span>
            <span class="c1"># x3,y3=tuple(self.nextpc)</span>
            <span class="c1"># ax.plot([x1,x2,x3], [y1,y2,y3], &#39;o&#39;)#, ms=5, fc=&#39;b&#39;, ec=&#39;b&#39;)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anote</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                        <span class="n">xy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anote</span><span class="p">[</span><span class="s1">&#39;xypos&#39;</span><span class="p">],</span>
                        <span class="n">xytext</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_anote</span><span class="p">[</span><span class="s1">&#39;textpos&#39;</span><span class="p">],</span>
                        <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">),</span>
                        <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="MagBlock.getPosition"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.getPosition">[docs]</a>    <span class="k">def</span> <span class="nf">getPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the element position along beamline/lattice, in [m]</span>
<span class="sd">        should be initialized in Models.initPos() method first</span>
<span class="sd">        (by default, will complete after Models.addElement() method)</span>
<span class="sd">        i.e. valid position in [m] would return after lattice modeled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spos</span></div>
    
<div class="viewcode-block" id="MagBlock.setPosition"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.setPosition">[docs]</a>    <span class="k">def</span> <span class="nf">setPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element position along beamline/lattice, in [m]</span>

<span class="sd">        :param s: element position measured by meter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spos</span> <span class="o">=</span> <span class="n">s</span></div>

<div class="viewcode-block" id="MagBlock.getLength"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.getLength">[docs]</a>    <span class="k">def</span> <span class="nf">getLength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return element length if valid, or return 0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">l</span></div>

<div class="viewcode-block" id="MagBlock.getMatrix"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.getMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">getMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return 6 x6 dims transport matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transM_flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;warning: invoke calcTransM() to update transport matrix.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transM</span></div>
    
<div class="viewcode-block" id="MagBlock.getR"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.MagBlock.getR">[docs]</a>    <span class="k">def</span> <span class="nf">getR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return transport matrix element, indexed by i(row) and j(col),</span>
<span class="sd">            with the initial index of 1</span>

<span class="sd">        :param i: row index</span>
<span class="sd">        :param j: col index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transM</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="ElementCharge"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCharge">[docs]</a><span class="k">class</span> <span class="nc">ElementCharge</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; charge element</span>

<span class="sd">    :param name: charge element name that could be used in other method, e.g. &#39;C&#39;, &#39;Q&#39;, etc.</span>
<span class="sd">    :param config:</span>

<span class="sd">    :Example:</span>

<span class="sd">    &gt;&gt;&gt; chconf = {&#39;total&#39;: 1.0e-9}  # total charge of 1.0 nC</span>
<span class="sd">    &gt;&gt;&gt; q = ElementCharge(name=&#39;q&#39;, config=chconf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;CHARGE&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElementCenter"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCenter">[docs]</a><span class="k">class</span> <span class="nc">ElementCenter</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; center element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;CENTER&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElementCsrcsben"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCsrcsben">[docs]</a><span class="k">class</span> <span class="nc">ElementCsrcsben</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; csrcsben element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;CSRCSBEN&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;bend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">][</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementCsrcsben.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCsrcsben.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementCsrcsben.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCsrcsben.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: rotation angle [deg] of drawing central point, angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>  <span class="c1"># element width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span>  <span class="c1"># bending angle, [deg]</span>
        <span class="n">_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>
        <span class="n">_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span>
        <span class="n">_fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span><span class="p">]</span>
        <span class="n">_ec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;ec&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="n">_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="c1"># _angle &gt;= 0:</span>
            <span class="c1">#     p1---p2</span>
            <span class="c1">#     |    |</span>
            <span class="c1">#     |    |</span>
            <span class="c1">#   --p0---p3--</span>
            <span class="c1"># </span>
            <span class="c1"># _angle &lt; 0:</span>
            <span class="c1">#   --p0---p3--</span>
            <span class="c1">#     |    |</span>
            <span class="c1">#     |    |</span>
            <span class="c1">#     p1---p2</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y0</span>

            <span class="k">if</span> <span class="n">_angle</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_height</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># _angle &lt; 0</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">_height</span>
            
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_width</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_fc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_ec</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode</span>
            <span class="c1">#   p1---p6---p2</span>
            <span class="c1">#   |         |</span>
            <span class="c1"># --p0   pc   p3-- </span>
            <span class="c1">#   |         |</span>
            <span class="c1">#   p5---p7---p4</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_height</span><span class="o">*</span><span class="mf">0.5</span>
            <span class="n">x6</span><span class="p">,</span> <span class="n">y6</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">_width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_width</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">_height</span><span class="o">*</span><span class="mf">0.5</span>
            <span class="n">x7</span><span class="p">,</span> <span class="n">y7</span> <span class="o">=</span> <span class="n">x6</span><span class="p">,</span> <span class="n">y4</span>
            <span class="n">x5</span><span class="p">,</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y4</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y0</span>

            <span class="n">vs0</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x6</span><span class="p">,</span> <span class="n">y6</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x7</span><span class="p">,</span> <span class="n">y7</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x5</span><span class="p">,</span> <span class="n">y5</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="n">vs0</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                    <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_fc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_ec</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">rot</span><span class="p">((</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="n">theta</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="n">_angle</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div>

<div class="viewcode-block" id="ElementCsrcsben.calcTransM"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCsrcsben.calcTransM">[docs]</a>    <span class="k">def</span> <span class="nf">calcTransM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">,</span> <span class="n">incsym</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate transport matrix</span>

<span class="sd">        :param gamma: electron energy measured by mc^2</span>
<span class="sd">        :param type: configuration type, &#39;simu&#39; (simulation mode) or &#39;online&#39; (online mode)</span>
<span class="sd">        :param incsym: incident symmetry, -1, 0, 1</span>
<span class="sd">        :return: transport matrix</span>
<span class="sd">        :rtype: numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>
        <span class="n">bend_length</span> <span class="o">=</span> <span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">bend_length</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="c1">#rho = np.sqrt(gamma**2-1)*m0*c0/bend_field/e0</span>
        <span class="c1">#theta = np.arcsin(bend_length/rho)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM</span> <span class="o">=</span> <span class="n">mathutils</span><span class="o">.</span><span class="n">transRbend</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">incsym</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gamma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m0</span> <span class="o">=</span> <span class="mf">9.10938215e-31</span>
            <span class="n">e0</span> <span class="o">=</span> <span class="mf">1.602176487e-19</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="mf">299792458.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bend_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">m0</span><span class="o">*</span><span class="n">c0</span><span class="o">/</span><span class="n">rho</span><span class="o">/</span><span class="n">e0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span> <span class="o">=</span> <span class="n">rho</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">({</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_rho</span><span class="p">,</span> <span class="s1">&#39;field&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_bend_field</span><span class="p">},</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;misc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transM</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: magnetic field, [T]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bend_field</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: bending radius, [m]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span></div>

<div class="viewcode-block" id="ElementCsrdrift"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCsrdrift">[docs]</a><span class="k">class</span> <span class="nc">ElementCsrdrift</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; csrdrift element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;CSRDRIFT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementCsrdrift.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCsrdrift.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementCsrdrift.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCsrdrift.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        
        <span class="c1">#</span>
        <span class="c1"># --p0-------p1--</span>
        <span class="c1"># </span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, same as plain, could be more fancy(Apr.08, 2016)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_length</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div>

<div class="viewcode-block" id="ElementCsrdrift.calcTransM"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementCsrdrift.calcTransM">[docs]</a>    <span class="k">def</span> <span class="nf">calcTransM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;calculate transport matrix</span>

<span class="sd">        :param gamma: electron energy measured by mc^2</span>
<span class="sd">        :return: transport matrix</span>
<span class="sd">        :rtype: numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM</span> <span class="o">=</span> <span class="n">mathutils</span><span class="o">.</span><span class="n">transDrift</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transM</span></div></div>

<div class="viewcode-block" id="ElementDrift"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementDrift">[docs]</a><span class="k">class</span> <span class="nc">ElementDrift</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; drift element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;DRIFT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementDrift.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementDrift.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementDrift.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementDrift.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        
        <span class="c1">#</span>
        <span class="c1"># --p0-------p1--</span>
        <span class="c1"># </span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, same as plain, could be more fancy(Apr.08, 2016)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_length</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div>
        
<div class="viewcode-block" id="ElementDrift.calcTransM"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementDrift.calcTransM">[docs]</a>    <span class="k">def</span> <span class="nf">calcTransM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;calculate transport matrix</span>

<span class="sd">        :param gamma: electron energy measured by mc^2</span>
<span class="sd">        :return: transport matrix</span>
<span class="sd">        :rtype: numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM</span> <span class="o">=</span> <span class="n">mathutils</span><span class="o">.</span><span class="n">transDrift</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transM</span></div></div>

<div class="viewcode-block" id="ElementKicker"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementKicker">[docs]</a><span class="k">class</span> <span class="nc">ElementKicker</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; kicker element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;KICKER&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementKicker.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementKicker.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementKicker.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementKicker.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis, angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        
        <span class="c1">#</span>
        <span class="c1"># --p0-------p1--</span>
        <span class="c1"># </span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, same as plain, could be more fancy(Apr.08, 2016)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_length</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div></div>

<div class="viewcode-block" id="ElementLscdrift"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementLscdrift">[docs]</a><span class="k">class</span> <span class="nc">ElementLscdrift</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; lscdrift element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;LSCDRIFT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementLscdrift.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementLscdrift.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementLscdrift.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementLscdrift.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis, angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lemgth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        
        <span class="c1">#</span>
        <span class="c1"># --p0-------p1--</span>
        <span class="c1"># </span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, same as plain, could be more fancy(Apr.08, 2016)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_length</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div>

<div class="viewcode-block" id="ElementLscdrift.calcTransM"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementLscdrift.calcTransM">[docs]</a>    <span class="k">def</span> <span class="nf">calcTransM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;calculate transport matrix</span>

<span class="sd">        :param gamma: electron energy measured by mc^2</span>
<span class="sd">        :return: transport matrix</span>
<span class="sd">        :rtype: numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM</span> <span class="o">=</span> <span class="n">mathutils</span><span class="o">.</span><span class="n">transDrift</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transM</span></div></div>

<div class="viewcode-block" id="ElementMark"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementMark">[docs]</a><span class="k">class</span> <span class="nc">ElementMark</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; mark element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;MARK&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementMark.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementMark.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementMark.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementMark.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis, angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        
        <span class="c1">#</span>
        <span class="c1"># --p0-------p1--</span>
        <span class="c1"># </span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, same as plain, could be more fancy(Apr.08, 2016)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_length</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div></div>

<div class="viewcode-block" id="ElementMoni"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementMoni">[docs]</a><span class="k">class</span> <span class="nc">ElementMoni</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; moni element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;MONI&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;moni&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementMoni.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementMoni.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementMoni.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementMoni.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis, angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_fancyc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="n">_plainc</span> <span class="o">=</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        
        <span class="c1">#</span>
        <span class="c1">#   |</span>
        <span class="c1"># --p0--p1--</span>
        <span class="c1">#   |</span>
        <span class="c1"># </span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_length</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_plainc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_plainc</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, same as plain, could be more fancy(Apr.08, 2016)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="c1">#x1, y1 = x0 + _length, y0 + _length * np.tan(_theta)</span>
            <span class="c1">#pc = x0 + 0.5*_length, (y0 + y1)*0.5</span>

            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">_length</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x5</span><span class="p">,</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y0</span>
            <span class="n">x6</span><span class="p">,</span> <span class="n">y6</span> <span class="o">=</span> <span class="n">x5</span><span class="p">,</span> <span class="n">y5</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">_length</span>
            <span class="n">x7</span><span class="p">,</span> <span class="n">y7</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y6</span>
            <span class="n">x8</span><span class="p">,</span> <span class="n">y8</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y7</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">_length</span>
            <span class="n">x9</span><span class="p">,</span> <span class="n">y9</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y8</span>
            <span class="n">x10</span><span class="p">,</span> <span class="n">y10</span> <span class="o">=</span> <span class="n">x9</span><span class="p">,</span> <span class="n">y7</span>
            <span class="n">x11</span><span class="p">,</span> <span class="n">y11</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y7</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x5</span><span class="p">)</span> <span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>

            <span class="n">verts1</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span>
                    <span class="n">pc</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x5</span><span class="p">,</span> <span class="n">y5</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x6</span><span class="p">,</span> <span class="n">y6</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x7</span><span class="p">,</span> <span class="n">y7</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x8</span><span class="p">,</span> <span class="n">y8</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x9</span><span class="p">,</span> <span class="n">y9</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x10</span><span class="p">,</span> <span class="n">y10</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x11</span><span class="p">,</span> <span class="n">y11</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                <span class="p">]</span>

            <span class="n">codes1</span> <span class="o">=</span> <span class="p">[</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span>
                     <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">,</span>
                    <span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts1</span><span class="p">,</span> <span class="n">codes1</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_fancyc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_fancyc</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="c1">#self.next_p0 = x1, y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x5</span><span class="p">,</span> <span class="n">y5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div></div>

<div class="viewcode-block" id="ElementQuad"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementQuad">[docs]</a><span class="k">class</span> <span class="nc">ElementQuad</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; quad element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;QUAD&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;quad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">][</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="ElementQuad.unitTrans"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementQuad.unitTrans">[docs]</a>    <span class="k">def</span> <span class="nf">unitTrans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inval</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">transfun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">transfun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfun</span>
        <span class="k">if</span> <span class="n">transfun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outval</span> <span class="o">=</span> <span class="n">transfun</span><span class="p">(</span><span class="n">inval</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use builtin translation rules</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>  <span class="c1"># PV-&gt;physical</span>
                <span class="n">outval</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">inval</span>
            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>  <span class="c1"># physical-&gt;PV</span>
                <span class="n">outval</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">inval</span>
        <span class="k">return</span> <span class="n">outval</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementQuad.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementQuad.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementQuad.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementQuad.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: rotation angle [deg] of drawing central point, angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: anticlockwise, &#39;-&#39;: clockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>  <span class="c1"># element width</span>
        <span class="n">_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>
        <span class="n">_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span>
        <span class="n">_fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span><span class="p">]</span>
        <span class="n">_ec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;ec&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="n">_kval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">])</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="c1"># _kval &gt;= 0:</span>
            <span class="c1">#    p1---p2</span>
            <span class="c1">#    |    |</span>
            <span class="c1">#    |    |</span>
            <span class="c1"># ---p0---p3---</span>
            <span class="c1">#</span>
            <span class="c1"># _kval &lt; 0:</span>
            <span class="c1"># ---p0---p3---</span>
            <span class="c1">#    |    |</span>
            <span class="c1">#    |    |</span>
            <span class="c1">#    p1---p2</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>

            <span class="k">if</span> <span class="n">_kval</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_height</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">_height</span>

            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_width</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span>

            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_fc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_ec</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode</span>
            <span class="c1">#       p1</span>
            <span class="c1">#     /    \</span>
            <span class="c1"># --p0  pc  p2(nextp0)---</span>
            <span class="c1">#     \    /</span>
            <span class="c1">#       p3</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_height</span><span class="o">*</span><span class="mf">0.5</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">_width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y0</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">_height</span><span class="o">*</span><span class="mf">0.5</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y0</span>

            <span class="n">vs0</span> <span class="o">=</span> <span class="p">[</span>
                  <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> 
                  <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> 
                  <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> 
                  <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
                  <span class="p">]</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="n">vs0</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span>
                  <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span>
                  <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                  <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                  <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span>
                  <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span>
                  <span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_fc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_ec</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="n">pout</span> <span class="o">=</span> <span class="n">x0</span><span class="o">+</span><span class="n">_width</span><span class="p">,</span> <span class="n">y0</span>   <span class="c1"># the right most point in x-axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">MagBlock</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="n">pout</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">pc</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_width</span><span class="p">,</span> <span class="n">y0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div>

<div class="viewcode-block" id="ElementQuad.calcTransM"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementQuad.calcTransM">[docs]</a>    <span class="k">def</span> <span class="nf">calcTransM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;calculate transport matrix</span>

<span class="sd">        :param gamma: electron energy measured by mc^2</span>
<span class="sd">        :return: transport matrix</span>
<span class="sd">        :rtype: numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getK1</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ctrl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM</span> <span class="o">=</span> <span class="n">mathutils</span><span class="o">.</span><span class="n">transQuad</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transM_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transM</span></div>

<div class="viewcode-block" id="ElementQuad.getK1"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementQuad.getK1">[docs]</a>    <span class="k">def</span> <span class="nf">getK1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get quad k1 value</span>

<span class="sd">        :param type: &#39;simu&#39; or &#39;online&#39;</span>
<span class="sd">        :return: quad strength,i.e. k1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;ctrl&#39;</span><span class="p">:</span>
            <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctrlinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;k1&#39;</span><span class="p">)[</span><span class="s1">&#39;pv&#39;</span><span class="p">]</span>
            <span class="n">rval</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitTrans</span><span class="p">(</span><span class="n">rval</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="ElementRfcw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementRfcw">[docs]</a><span class="k">class</span> <span class="nc">ElementRfcw</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; rfcw element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;RFCW&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementRfcw.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementRfcw.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementRfcw.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementRfcw.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="n">_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="n">freqi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2856.0e6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freqi</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="n">freqi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_fancyc</span> <span class="o">=</span> <span class="s1">&#39;#FFDDBB&#39;</span> <span class="c1"># S band</span>
            <span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>
        <span class="k">elif</span> <span class="n">freqi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">_fancyc</span> <span class="o">=</span> <span class="s1">&#39;#5E5EFF&#39;</span> <span class="c1"># C band</span>
            <span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
        <span class="k">elif</span> <span class="n">freqi</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">_fancyc</span> <span class="o">=</span> <span class="s1">&#39;#8800FF&#39;</span> <span class="c1"># X band</span>
            <span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_fancyc</span> <span class="o">=</span> <span class="s1">&#39;#FFBB00&#39;</span> <span class="c1"># other</span>
            <span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;..&#39;</span>
        
        <span class="c1">#</span>
        <span class="c1">#   p1-------p2</span>
        <span class="c1">#   |        |</span>
        <span class="c1"># --p0       p3--</span>
        <span class="c1">#   |        |</span>
        <span class="c1">#   p5-------p4</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_height</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_height</span>
            <span class="n">x5</span><span class="p">,</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y4</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">),</span> <span class="p">(</span><span class="n">x5</span><span class="p">,</span> <span class="n">y5</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, </span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_height</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_height</span>
            <span class="n">x5</span><span class="p">,</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y4</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">),</span> <span class="p">(</span><span class="n">x5</span><span class="p">,</span> <span class="n">y5</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_fancyc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_fancyc</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_atext</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">_text</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">,</span>
                       <span class="s1">&#39;atext&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atext</span><span class="p">}</span></div></div>

<div class="viewcode-block" id="ElementRfdf"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementRfdf">[docs]</a><span class="k">class</span> <span class="nc">ElementRfdf</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; rfdf element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;RFDF&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementRfdf.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementRfdf.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementRfdf.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementRfdf.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis, angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="n">_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="n">freqi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2856.0e6</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;frequency&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="n">freqi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2856.0e6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freqi</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="n">freqi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_fancyc</span> <span class="o">=</span> <span class="s1">&#39;#FFDDBB&#39;</span> <span class="c1"># S band</span>
            <span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;SD&#39;</span>
        <span class="k">elif</span> <span class="n">freqi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">_fancyc</span> <span class="o">=</span> <span class="s1">&#39;#5E5EFF&#39;</span> <span class="c1"># C band</span>
            <span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;CD&#39;</span>
        <span class="k">elif</span> <span class="n">freqi</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">_fancyc</span> <span class="o">=</span> <span class="s1">&#39;#8800FF&#39;</span> <span class="c1"># X band</span>
            <span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;XD&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_fancyc</span> <span class="o">=</span> <span class="s1">&#39;#FFBB00&#39;</span> <span class="c1"># other</span>
            <span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;..&#39;</span>
        
        <span class="c1">#</span>
        <span class="c1">#   p1-------p2</span>
        <span class="c1">#   |        |</span>
        <span class="c1"># --p0       p3--</span>
        <span class="c1">#   |        |</span>
        <span class="c1">#   p5-------p4</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_height</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_height</span>
            <span class="n">x5</span><span class="p">,</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y4</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">),</span> <span class="p">(</span><span class="n">x5</span><span class="p">,</span> <span class="n">y5</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, </span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_height</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span>
            <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_height</span>
            <span class="n">x5</span><span class="p">,</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y4</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">),</span> <span class="p">(</span><span class="n">x5</span><span class="p">,</span> <span class="n">y5</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_fancyc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_fancyc</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_atext</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">_text</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">,</span>
                       <span class="s1">&#39;atext&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atext</span><span class="p">}</span></div></div>

<div class="viewcode-block" id="ElementWake"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementWake">[docs]</a><span class="k">class</span> <span class="nc">ElementWake</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; wake element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;WAKE&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementWake.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementWake.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementWake.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementWake.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis, angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        
        <span class="c1">#</span>
        <span class="c1"># --p0-------p1--</span>
        <span class="c1"># </span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, same as plain, could be more fancy(Apr.08, 2016)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span></div></div>

<div class="viewcode-block" id="ElementWatch"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementWatch">[docs]</a><span class="k">class</span> <span class="nc">ElementWatch</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; watch element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;WATCH&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MagBlock</span><span class="o">.</span><span class="n">_MagBlock__styleconfig_dict</span><span class="p">[</span><span class="s1">&#39;drift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>

<div class="viewcode-block" id="ElementWatch.setStyle"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementWatch.setStyle">[docs]</a>    <span class="k">def</span> <span class="nf">setStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">style</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>

<div class="viewcode-block" id="ElementWatch.setDraw"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementWatch.setDraw">[docs]</a>    <span class="k">def</span> <span class="nf">setDraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set element visualization drawing</span>
<span class="sd">            </span>
<span class="sd">        :param p0: start drawing position, (x,y)</span>
<span class="sd">        :param angle: angle [deg] between x-axis angle is rotating from x-axis to be &#39;+&#39; or &#39;-&#39;, &#39;+&#39;: clockwise, &#39;-&#39;: anticlockwise</span>
<span class="sd">        :param mode: artist mode, &#39;plain&#39; or &#39;fancy&#39;, &#39;plain&#39; by default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfig</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">sconf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sconf</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">_theta</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># deg to rad</span>
        <span class="n">_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
        <span class="n">_lw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
        <span class="n">_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        
        <span class="c1">#</span>
        <span class="c1"># --p0-------p1--</span>
        <span class="c1"># </span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;plain&#39;</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># fancy mode, same as plain, could be more fancy(Apr.08, 2016)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">p0</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">_length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">_theta</span><span class="p">)</span>
            <span class="n">vs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">]</span>
            <span class="n">pth</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
            <span class="n">ptch</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">_lw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">_alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ptch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_p0</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_inc_angle</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">pc</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">_length</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anote</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xypos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;textpos&#39;</span><span class="p">:</span> <span class="n">pc</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">typename</span><span class="p">}</span></div></div>

<div class="viewcode-block" id="ElementBeamline"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.ElementBeamline">[docs]</a><span class="k">class</span> <span class="nc">ElementBeamline</span><span class="p">(</span><span class="n">MagBlock</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; beamline element, virtual element, does not present in ELEGANT</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bl&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">MagBlock</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="s1">&#39;BEAMLINE&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>

<span class="n">ElementDrif</span> <span class="o">=</span> <span class="n">ElementDrift</span>
<span class="n">ElementLscdrif</span> <span class="o">=</span> <span class="n">ElementLscdrift</span>
<span class="n">ElementCsrdrif</span> <span class="o">=</span> <span class="n">ElementCsrdrift</span>
<span class="n">ElementCsrcsbent</span> <span class="o">=</span> <span class="n">ElementCsrcsben</span>


<div class="viewcode-block" id="test"><a class="viewcode-back" href="../../src/apidocs/element.html#beamline.element.test">[docs]</a><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; For example, define lattice configuration for a 4-dipole chicane with quads</span>
<span class="sd">                    |-|---|-|  </span>
<span class="sd">                    /       \</span>
<span class="sd">          ---||---|-|       |-|---||---</span>

<span class="sd">        i.e.   drift + quad  + drift </span>
<span class="sd">            + dipole + drift + dipole + drift </span>
<span class="sd">            + dipole + drift + dipole</span>
<span class="sd">            + drift  + quad  + drift</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># typical workflow:</span>

    <span class="c1"># STEP 1: define common information, two different input parameter formats</span>
    <span class="c1"># commdinfo = {&#39;DATE&#39;: &#39;2016-03-22&#39;, &#39;AUTHOR&#39;: &#39;Tong Zhang&#39;}</span>
    <span class="n">comminfo</span> <span class="o">=</span> <span class="s1">&#39;DATE = 2016-03-24, 16:05, AUTHOR = Tong Zhang&#39;</span>
    <span class="n">MagBlock</span><span class="o">.</span><span class="n">setCommInfo</span><span class="p">(</span><span class="n">comminfo</span><span class="p">)</span>

    <span class="c1"># STEP 2: create element</span>

    <span class="c1"># charge</span>
    <span class="n">chconf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span><span class="p">}</span>
    <span class="n">CH</span> <span class="o">=</span> <span class="n">ElementCharge</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Q1&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">chconf</span><span class="p">)</span>

    <span class="c1"># csrcsben</span>
    <span class="n">simconf</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;edge1_effects&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s2">&quot;edge2_effects&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s2">&quot;hgap&quot;</span><span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>
               <span class="s2">&quot;csr&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
               <span class="s2">&quot;nonlinear&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s2">&quot;n_kicks&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
               <span class="s2">&quot;integration_order&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
               <span class="s2">&quot;bins&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
               <span class="s2">&quot;sg_halfwidth&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s2">&quot;block_csr&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
               <span class="s1">&#39;l&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">}</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="n">B1</span> <span class="o">=</span> <span class="n">ElementCsrcsben</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;b1&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="n">angle</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="n">angle</span><span class="p">})</span>
    <span class="n">B1</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">simconf</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
    <span class="c1"># B1.setConf(&quot;pv=sxfel:lattice:b1&quot;,  type = &#39;ctrl&#39;)</span>

    <span class="n">B2</span> <span class="o">=</span> <span class="n">ElementCsrcsben</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;b2&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">angle</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">angle</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
    <span class="n">B3</span> <span class="o">=</span> <span class="n">ElementCsrcsben</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;b3&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">angle</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">angle</span><span class="p">})</span>
    <span class="n">B4</span> <span class="o">=</span> <span class="n">ElementCsrcsben</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;b4&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="n">angle</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="n">angle</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
    <span class="n">B2</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">simconf</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
    <span class="n">B3</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">simconf</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>
    <span class="n">B4</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">simconf</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>

    <span class="c1"># drift</span>
    <span class="n">D0</span> <span class="o">=</span> <span class="n">ElementDrift</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;D0&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;l=1.0&quot;</span><span class="p">)</span>

    <span class="c1"># quad</span>
    <span class="n">Q1</span> <span class="o">=</span> <span class="n">ElementQuad</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Q1&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;k1 = 10, l = 0.1&quot;</span><span class="p">)</span>
    <span class="n">dftconf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tilt&#39;</span><span class="p">:</span> <span class="s2">&quot;pi 4 /&quot;</span><span class="p">}</span>
    <span class="n">Q1</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">dftconf</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;simu&#39;</span><span class="p">)</span>

    <span class="c1"># beamline</span>
    <span class="n">latele</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="p">[</span><span class="n">D0</span><span class="p">,</span> <span class="n">Q1</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">B2</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">B3</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">B4</span><span class="p">,</span> <span class="n">D0</span><span class="p">,</span> <span class="n">Q1</span><span class="p">,</span> <span class="n">D0</span><span class="p">]]</span>
    <span class="n">latstr</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">latele</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

    <span class="n">bl</span> <span class="o">=</span> <span class="n">ElementBeamline</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bl&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lattice&#39;</span><span class="p">:</span> <span class="n">latstr</span><span class="p">})</span>
    <span class="c1"># bl = ElementBeamline(name = &#39;bl1&#39;, config = &quot;lattice = (q d0 q1)&quot;)</span>
    <span class="c1"># bl.setConf(&quot;lattice = (d,q,b)&quot;, type = &#39;simu&#39;)</span>
    <span class="nb">print</span> <span class="n">bl</span></div>

    <span class="c1"># print MagBlock.sumObjNum()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>

</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">beamline 1.3.5 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Tong Zhang.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>